---
title: KNN Regression
date: 2021-04-16 11:00:00
categories:
  - Machine Learning
tags:
  - machine-learning
  - ml
  - knn
  - regression
  - kaggle
  - competition
typora-root-url: ../
---



## [ML] KNNì„ í™œìš©í•œ íšŒê·€ ë¬¸ì œ

> Week#5-3 / [Video](https://www.youtube.com/watch?v=w5RWGz5BxBY&list=PL1xKqHsVFgvktrttPFUK8ayVr0oTz5RoN&index=16) / Reference: Prof.Choi



### KNN Regression

ë°ì´í„° ê°€ê³µ, scoring ê³¼ì • ë“±ì€ KNN classificationê³¼ ë™ì¼í•˜ì§€ë§Œ yì˜ ì˜ˆì¸¡ì¹˜ ê³„ì‚°ë§Œ ë‹¤ë¥´ë‹¤. Regressionì˜ ê²½ìš° kê°œ ê´€ì¸¡ì¹˜ (ğ’™áµ¢, ğ’šáµ¢)ì—ì„œ È³ë¥¼ ê³„ì‚°í•˜ì—¬ ì í•©ì¹˜ë¡œ ì‚¬ìš©í•œë‹¤.

- ë‹¨ìˆœ íšŒê·€: ê°€ê¹Œìš´ ì´ì›ƒë“¤ì˜ ë‹¨ìˆœí•œ í‰ê· ì„ êµ¬í•˜ëŠ” ë°©ì‹

- ê°€ì¤‘ íšŒê·€: ê° ì´ì›ƒì´ ì–¼ë§ˆë‚˜ ê°€ê¹Œì´ ìˆëŠ”ì§€ì— ë”°ë¼ weighted average(ê°€ì¤‘ í‰ê· ) ë¥¼ êµ¬í•´ ê±°ë¦¬ê°€ ê°€ê¹Œìš¸ìˆ˜ë¡ ë°ì´í„°ê°€ ë” ìœ ì‚¬í•  ê²ƒì´ë¼ê³  ë³´ê³  ê°€ì¤‘ì¹˜ë¥¼ ë¶€ì—¬í•˜ëŠ” ë°©ì‹.

- ex) ì˜í™” Xì˜ ë“±ê¸‰ì„ ì°¾ê¸° ìœ„í•´ 3-NN ê²€ìƒ‰ ê²°ê³¼

  <img src="/images/post15-ml-w5-3/1.png" alt="table" style="zoom:30%;border:none" />  
  <img src="/images/post15-ml-w5-3/2.png" alt="wgt-ave" style="zoom:25%;border:none" />
  
  > ë‹¨ìˆœ í‰ê· ì€ 6.93ì¸ë° ë°˜í•´ ê°€ì¤‘ í‰ê· ì€ 7.9ì´ë‹¤.



### Overview

#### ìë™ì°¨ ê°€ê²© ì˜ˆì¸¡

> ë³¸ ë°ì´í„° ì…‹ì€ kaggle open datasetìœ¼ë¡œ ì˜êµ­ì˜ ì¤‘ê³ ì°¨ëŸ‰ ì •ë³´ë“¤ë¡œ êµ¬ì„±ë˜ì–´ìˆìœ¼ë©°, ì„¸ì¢…ëŒ€í•™êµ ìµœìœ ê²½ êµìˆ˜ë‹˜ì˜ [ìë™ì°¨ ê°€ê²© ì˜ˆì¸¡](https://www.kaggle.com/c/2021-ml-p6/overview) competitionë¥¼ ì¶œì²˜ë¡œ ë‘”ë‹¤.

#### Description

í•´ë‹¹ ë°ì´í„° ì…‹ì€ ì¤‘ê³  ì°¨ëŸ‰ì— ëŒ€í•œ ê°€ê²©, ë³€ì†ê¸°, ë§ˆì¼ë¦¬ì§€, ì—°ë£Œ ìœ í˜•, ë„ë¡œì„¸, ê°¤ëŸ°ë‹¹ ë§ˆì¼ë¦¬ì§€(mpg), ì œì¡°íšŒì‚¬ ë° ì—”ì§„ í¬ê¸° ë“±ì„ í¬í•¨í•œë‹¤. ìœ„ì— ì–¸ê¸‰í•œ ì°¨ëŸ‰ì˜ ì •ë³´ë“¤(ì œì¡°íšŒì‚¬, ì—”ì§„í¬ê¸°, ë³€ì†ê¸° ë“±)ì„ í†µí•˜ì—¬ í•´ë‹¹ ì°¨ëŸ‰ì˜ ê°€ê²©ì„ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì´ í•´ë‹¹ ì‹¤ìŠµì˜ ëª©í‘œì´ë‹¤.

- **company** - ìë™ì°¨ ì œì¡° íšŒì‚¬, ì´ 5ê°œ(bmw, ford, hyundai, audi, toyota)ì˜ íšŒì‚¬ë¡œ êµ¬ì„±
- **model** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ì œí’ˆëª…(ëª¨ë¸)
- **year** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ì œì¡°ë…„ë„
- **transmission** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ë³€ì†ê¸°
- **mileage** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ë§ˆì¼ë¦¬ì§€
- **fueltype** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ì—°ë£Œ ìœ í˜•
- **tax** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ì„¸ê¸ˆ
- **mpg** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ë§ˆì¼ ë‹¹ ê°¤ëŸ° ì‚¬ìš©ëŸ‰(ì—°ë¹„)
- **enginesize** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ì—”ì§„ í¬ê¸°ë¥¼ ì˜ë¯¸
- **price** - í•´ë‹¹ ì°¨ëŸ‰ì˜ ê°€ê²©ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

Data êµ¬ì„± ìš”ì†ŒëŠ” ìœ„ì™€ ê°™ìœ¼ë©°, ë³¸ ë¬¸ì œì˜ í‰ê°€ ë°©ì‹ì€ **MAE**(Mean Absolute Error)ì´ë‹¤.

> ì¦‰, Kaggle ì±„ì  ê²°ê³¼ ê°’ì´ ë‚®ì„ìˆ˜ë¡ ë” ì •í™•í•œ ëª¨ë¸ì´ë¼ëŠ” ê²ƒ



### Preparation

- kaggle install

  ~~~python
  !pip uninstall -y kaggle
  !pip install --upgrade pip
  !pip install kaggle==1.5.6
  ~~~

- API token upload

  ~~~python
  !mkdir -p ~/.kaggle
  !cp kaggle.json ~/.kaggle/
  !chmod 600 ~/.kaggle/kaggle.json
  ~~~

- Import libraries

  ~~~python
  import numpy as np
  import pandas as pd
  ~~~


### Data Loading

Competitionì˜ Data íƒ­ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

- Import dataset from Kaggle

  ~~~python
  !kaggle competitions download -c 2021-ml-p6
  !unzip 2021-ml-p6.zip
  ~~~

- Input data

  ~~~python
  car = pd.read_csv('train_data.csv') # file read
  test = pd.read_csv('test_data.csv')
  
  car = car.drop(['ID'], axis = 1) # ë¶ˆí•„ìš”í•œ 'ID'ì—´ ì œê±°
  test = test.drop(['ID'], axis = 1)
  x = car.drop(['price'], axis = 1) # 'price'ì—´ drop í›„ input Xë¡œ ì •ì˜
  y = car['price'] # 'price'ì—´ label Yë¡œ ì •ì˜
  ~~~

  

### Data Preprocessing

- Category transforming

  ~~~python
  from sklearn.preprocessing import LabelEncoder
  le = LabelEncoder()
  le.fit(x['model'].tolist()) # xë§Œ fit ì‹œì¼œì£¼ê³ 
  print(le.transform(x['model'].tolist())) # transformí•œ ë’¤,
  print(le.transform(test['model'].tolist())) # testëŠ” xì˜ ì‹¤ìˆ˜í™” ê²½í–¥ì„ ë”°ë¥´ë„ë¡ í•œë‹¤.
  ~~~

  `[15 87 26 ... 25 33 25]`  
  `[44 46 60 ... 46 13 59]`

- Inverse (ê¸°ì¡´ ë¬¸ìì—´ ë³€í™˜ check)

  ~~~python
  x_mod = le.inverse_transform(le.transform(x['model'].tolist()))
  test_mod = le.inverse_transform(le.transform(test['model'].tolist()))
  print(x_mod) # check
  print(test_mod)
  ~~~

  `[' Auris' ' X2' ' Focus' ... ' Fiesta' ' Hilux' ' Fiesta']`  
  `[' Ka+' ' Kuga' ' Q5' ... ' Kuga' ' A7' ' Q3']`

- Data Split (ì •í™•ë„ í™•ì¸ì„ ìœ„í•œ train, test set split)

  ~~~python
  from sklearn.model_selection import train_test_split
  
  x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=0, test_size=0.3)
  ~~~

- Standardization

  ~~~python
  from sklearn.preprocessing import StandardScaler
  sc = StandardScaler()
  sc.fit(x) # xì—ë§Œ fitì„ í•¨ìœ¼ë¡œì¨ ë‹¤ë¥¸ ë°ì´í„°ë“¤ë„ ê²½í–¥ì„±ì„ ë§ì¶°ì¤€ë‹¤
  
  x_sc = sc.transform(x)
  x_train_sc = sc.transform(x_train)
  x_test_sc = sc.transform(x_test)
  test_sc = sc.transform(test)
  ~~~

- Fitting for test

  > ì•ì„  Classificationê³¼ ë§ˆì°¬ê°€ì§€ë¡œ í•¨ìˆ˜ parameterëŠ” ì‹¤í—˜ì ìœ¼ë¡œ ê²°ì •í•œë‹¤. ì•„ë˜ì˜ scoring blockì„ ì°¸ê³ í•˜ì—¬ ì—¬ëŸ¬ ë²ˆ testí•˜ë©° nì˜ ê°œìˆ˜ì™€ distance metric, weightsë¥¼ ì¡°ì •í•´ì£¼ì—ˆë‹¤.

  ~~~python
  from sklearn.neighbors import KNeighborsRegressor
  knr = KNeighborsRegressor(n_neighbors=5, p=1, weights='distance')
  knr.fit(x_train_sc, y_train)
  ~~~

- Scoring

  ~~~python
  print('{:.4f}'.format(knr.score(x_test_sc, y_test))) # ì„±ëŠ¥ check
  ~~~

  `0.9480`  

- Fitting original / Summission

  > ê¸°ì¡´ì˜ unsplited datasetì„ ë‹¤ì‹œ í•™ìŠµì‹œì¼œ test dataë¥¼ ì˜ˆì¸¡í•œë‹¤.

  ~~~python
  knr.fit(x_sc, y)
  ~~~

  ~~~python
  pred = knr.predict(test_sc)
  ~~~

  ~~~python
  submit = pd.read_csv('sample_submit.csv')
  submit['price'] = pred
  ~~~

  ~~~python
  submit.to_csv('submit.csv', index = False)
  ~~~

  ~~~python
  !kaggle competitions submit -c 2021-ml-p6 -f testsub1.csv -m "Message"
  ~~~




### Result

<img src="/images/post15-ml-w5-3/3.png" alt="score" style="zoom:40%;border:none" /> 

MAEì— ë”°ë¼ 1283.53995 ì •ë„ë¡œ í‰ê°€ë˜ì—ˆë‹¤. Leaderboard ìƒì—ì„œëŠ” 86ëª… ì¤‘ 13th positionì •ë„ì´ë‹¤. ì•„ì‰½ê²Œ deadline ì´í›„ì— ë” ì¢‹ì€ ì ìˆ˜ê°€ ë‚˜ì™€ì„œ public scoreì—ëŠ” ë°˜ì˜ë˜ì§€ ì•Šì•˜ë‹¤. :sob: